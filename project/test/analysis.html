<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>jQuery.support</title>
    <link href="http://twitter.github.io/bootstrap/assets/css/bootstrap.css" rel="stylesheet">
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.7.1.js"></script>
    <script type="text/javascript" src="http://underscorejs.org/underscore.js"></script>
    <style>
        * { font-family: 微软雅黑; }
    </style>
    <script>
        $(function(){
            var url = 'http://nuyproxy.appspot.com/log?action=list'
            url = 'http://localhost:8888/log?action=list'
            $.ajax(url)
            .done(function(data){
                // 
                data = eval(data);
                data.sort(function(a, b){
                    return parseFloat(a.version) - parseFloat(b.version)
                })
                var repeat = {};
                var unique = $.map(data, function(item, i){
                    var id = item.userAgent + item.version;
                    if( !repeat[id] ) {
                        repeat[id] = true
                        return item
                    }
                })
                var versions = {};
                _.each(unique, function(item, index){
                    versions[item.version] = versions[item.version] || []
                    versions[item.version].push(item)
                })
                _.each(versions, function(support, version){
                    render(support, version)
                });

                function render(support, version){
                    var uas = _.map(support, function(item, key){
                        var ua = $.uaMatch( item.userAgent )
                        console.log(item.userAgent);
                        return ua.browser + '<br>' + ua.version
                        return item.userAgent;
                    });
                    var rs = {};
                    _.each(support, function(item, index){
                        _.each(item, function(value, name){
                            if(/^(date|version|type|action|userAgent|lib)$/.test(name)) return;
                            rs[name] = rs[name] || [];
                            rs[name].push(value)
                        });
                    })

                    // render
                    var table = $('<table>').addClass('table table-bordered'),
                        thead = $('<thead>').appendTo(table)
                        tbody = $('<tbody>').appendTo(table),
                        tr = $('<tr>');

                    var ths = tr.clone().appendTo(thead).append('<th>#</th><th>support</th>');
                    _.each(uas, function(item, index){
                        $('<th>').html(item)
                            .css('width', 75)
                            .appendTo(ths);
                    })
                    
                    var count = 1;
                    _.each(rs, function(value, name){
                        var row = tr.clone().appendTo(tbody)
                            .append('<td>' + (count++) + '</td>')
                            .append('<td>' + name + '</td>')
                        _.each(value, function(item, index){
                            $('<td>').text(item)
                                .addClass(item == 'true' ? 'alert-success': 'alert-error')
                                .appendTo(row)
                        })
                    })

                    $('.container')
                        .append('<h2>jQuery ' + version + '</h2>')
                        .append(table)
                }
                
            })
        });
    </script>
</head>
<body>
    <div class="container">

    </div>
</body>
</html>
