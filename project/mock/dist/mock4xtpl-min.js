/*! mock-data 23-08-2013 */
!function(a){var b,c=Mock.Util||require("../mock/util"),d=Mock.Random||require("../mock/random");KISSY.use("xtemplate",function(a,c){b=c});var e={debug:!1};e.mock=function(a,d,e,f){return e=e?c.extend({},e,b.RunTime.commands):b.RunTime.commands,f=f?c.extend({},f,b.RunTime.subTpls):b.RunTime.subTpls,this.gen(a,null,d,e,f,{})},e.parse=function(a){return b.compiler.parse(a)},e.gen=function(a,b,d,f,g,h){if("string"==typeof a){e.debug&&console.log("[tpl    ]\n",a);var i=this.parse(a);d=this.parseOptions(a,d);var j=this.gen(i,b,d,f,g,h);return j}if(b=b||[{}],d=d||{},this[a.type]!==c.noop){d.__path=d.__path||[],e.debug&&(console.log(),console.group("["+a.type+"]",JSON.stringify(a)),console.log("[context]","[before]",b.length,JSON.stringify(b)),console.log("[options]","[before]",d.__path.length,JSON.stringify(d)),console.log("[other  ]","[before]",JSON.stringify(h)));var k=d.__path.length;return this[a.type](a,b,d,f,g,h),e.debug&&console.log("[__path ]","[after ]",d.__path),(!h.hold||"function"==typeof h.hold&&!h.hold(a,d,b))&&d.__path.splice(k),e.debug&&(console.log("[context]","[after ]",b.length,JSON.stringify(b)),console.groupEnd()),b[b.length-1]}},e.parseOptions=function(a,b){var d,e,f,g=/<!--\s*\n*Mock\s*\n*([\w\W]+?)\s*\n*-->/g,h=a.match(g),i={};for(d=0;h&&d<h.length;d++)g.lastIndex=0,e=g.exec(h[d]),e&&(f=new Function("return "+e[1]),f=f(),c.extend(i,f));return c.extend(i,b)},e.parseVal=function(a,b){function d(a,b){if("object"==typeof b&&a in b)return[b[a]];for(var c=[],d=0;d<b.length;d++)c.push.apply(c,f(a,[b[d]]));return c}function e(a,b){if("object"==typeof b&&a in b)return[b[a]];var c=[];for(var d in b)c.push.apply(c,f(a,[b[d]]));return c}function f(a,b){for(var f=[],g=0;g<b.length;g++)"object"==typeof b[g]&&(a in b[g]?f.push(b[g][a]):f.push.apply(f,c.isArray(b[g])?d(a,b[g]):e(a,b[g])));return f}function g(a,b){for(var c="string"==typeof a?a.split("."):a.slice(0),d=[b];c.length;)d=f(c.shift(),d);return d}return g(a,b)},e.val=function(b,d,f,g){if(b!==d.__path[d.__path.length-1])throw new Error(b+"!=="+d.__path);if(g!==a&&(g=Mock.mock(g)),d){var h=Mock.mock(d);if(c.isString(h))return h;var i=e.parseVal(d.__path,h);if(i.length>0)return i[0];if(b in h)return h[b]}return c.isArray(f[0])?{}:g!==a?g:b},e.program=function(a,b,c,d,e,f){for(var g=0;g<a.statements.length;g++)this.gen(a.statements[g],b,c,d,e,f);for(var h=0;a.inverse&&h<a.inverse.length;h++)this.gen(a.inverse[h],b,c,d,e,f)},e.block=function(b,e,f,g,h,i){var j=e.length;this.gen(b.tpl,e,f,g,h,c.extend({},i,{def:{},hold:!0}));var k,l,m,n=e[0];if("array"===c.type(n))for(k=this.val(f.__path[f.__path.length-1],f,e),m=k&&k.length||d.integer(3,7),l=0;m>l;l++)n.push(k&&k[l]!==a?k[l]:{}),f.__path.push(l),e.unshift(n[n.length-1]),this.gen(b.program,e,f,g,h,i),f.__path.pop(),e.shift();else this.gen(b.program,e,f,g,h,i);(!i.hold||"function"==typeof i.hold&&!i.hold(b,f,e))&&e.splice(0,e.length-j)},e.tpl=function(a,b,d,e,f,g){if(a.params&&a.params.length){g=c.extend({},g,{def:{each:[],"if":"@BOOL(2,1,true)",unless:"@BOOL(2,1,false)","with":{}}[a.path.string],hold:{each:!0,"if":function(a,b,c,d,e){return"object"==typeof e},unless:function(a,b,c,d,e){return"object"==typeof e},"with":!0,include:!1}[a.path.string]});for(var h,i=0;i<a.params.length;i++)h="include"===a.path.string?f&&f[a.params[i].value]:a.params[i],h&&this.gen(h,b,d,e,f,g);a.hash&&this.gen(a.hash,b,d,e,f,g)}else this.gen(a.path,b,d,e,f,g)},e.tplExpression=function(a,b,c,d,e,f){this.gen(a.expression,b,c,d,e,f)},e.content=c.noop,e.unaryExpression=c.noop,e.multiplicativeExpression=e.additiveExpression=function(b,e,f,g,h,i){this.gen(b.op1,e,f,g,h,c.extend({},i,{def:function(){return"number"===b.op2.type?b.op2.value.indexOf(".")>-1?d.float(-Math.pow(10,10),Math.pow(10,10),1,Math.pow(10,6)):d.integer():a}()})),this.gen(b.op2,e,f,g,h,c.extend({},i,{def:function(){return"number"===b.op1.type?b.op1.value.indexOf(".")>-1?d.float(-Math.pow(10,10),Math.pow(10,10),1,Math.pow(10,6)):d.integer():a}()}))},e.relationalExpression=function(a,b,c,d,e,f){this.gen(a.op1,b,c,d,e,f),this.gen(a.op2,b,c,d,e,f)},e.equalityExpression=c.noop,e.conditionalAndExpression=c.noop,e.conditionalOrExpression=c.noop,e.string=c.noop,e.number=c.noop,e.boolean=c.noop,e.hash=function(a,b,c,d,e,f){var g,h=a.value;for(g in h)this.gen(h[g],b,c,d,e,f)},e.id=function(b,d,f,g,h,i){function j(a,b,d,e,f){var g=c.type(a[e]),h=c.type(f);return f="true"===f?!0:"false"===f?!1:f,"undefined"===g?a[e]=d-1>b&&!c.isObjectOrArray(f)?{}:c.isArray(f)&&[]||f:d-1>b&&"object"!==g&&"array"!==g?a[e]=c.isArray(f)&&[]||{}:"object"!==g&&"array"!==g&&"object"!==h&&"array"!==h&&(a[e]=f),a[e]}var k,l,m,n,o,p=d.length,q=b.parts,r=d[b.depth];for(c.isArray(r)&&(r=d[b.depth+1]),k=0,l=q.length;l>k;k++)(0!==k||"this"!==q[k])&&(/^(xindex|xcount|xkey)$/.test(q[k])||0===k&&1===l&&q[k]in g||(f.__path.push(q[k]),m=q[k],n=k===l-1?i.def!==a?i.def:d[0][m]:{},o=this.val(m,f,d,n),e.debug&&(console.log("[def    ]",JSON.stringify(n)),console.log("[val    ]",JSON.stringify(o))),o=j(r,k,l,m,o),c.isObjectOrArray(r[m])&&d.unshift(r=r[m])));(!i.hold||"function"==typeof i.hold&&!i.hold(b,f,d,m,o))&&d.splice(0,d.length-p)},KISSY.use("xtemplate",function(a,b){return});var f={_:e,mock:function(a,b,c,d){return e.mock(a,b,c,d)},parse:e.parse};"object"==typeof module&&module.exports?module.exports=f:"function"==typeof define&&define.amd&&define(function(){return f}),this.Mock4XTpl=f,"undefined"!=typeof KISSY&&(KISSY.add("mock4xtpl",function(){return f},{requires:["mock","xtemplate"]}),KISSY.add("components/mock4xtpl/index",function(){return f},{requires:["mock","xtemplate"]}))}.call(this);